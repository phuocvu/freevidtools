<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FreeVidTools â€” Free Online Video Tools</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- Preload FFmpeg core files for faster startup -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/@ffmpeg/core@0.12.6/dist/esm/ffmpeg-core.js" as="script" crossorigin>
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/@ffmpeg/core@0.12.6/dist/esm/ffmpeg-core.wasm" as="fetch" crossorigin>

    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.3.1",
            "react-dom/client": "https://esm.sh/react-dom@18.3.1/client",
            "react/jsx-runtime": "https://esm.sh/react@18.3.1/jsx-runtime",
            "@ffmpeg/ffmpeg": "https://esm.sh/@ffmpeg/ffmpeg@0.12.10",
            "@ffmpeg/util": "https://esm.sh/@ffmpeg/util@0.12.1"
        }
    }
    </script>

    <style>
        :root {
            --bg-primary: #08080d;
            --bg-secondary: #0e0e16;
            --bg-card: #131320;
            --bg-card-hover: #1a1a2e;
            --border: #1e1e35;
            --border-hover: #2e2e4a;
            --text-primary: #eeeef5;
            --text-secondary: #8585a5;
            --text-muted: #50506a;
            --accent: #7c6cf0;
            --accent-light: #a8a0ff;
            --accent-glow: rgba(124, 108, 240, 0.25);
            --green: #00dfa8;
            --green-dim: #00b88a;
            --green-glow: rgba(0, 223, 168, 0.15);
            --orange: #ff8a50;
            --blue: #50b4ff;
            --pink: #ff5f96;
            --yellow: #ffc95c;
            --radius: 20px;
            --radius-md: 14px;
            --radius-sm: 10px;
            --radius-xs: 6px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }
        .bg-grid {
            position: fixed; inset: 0;
            background-image:
                linear-gradient(rgba(124,108,240,0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(124,108,240,0.03) 1px, transparent 1px);
            background-size: 60px 60px;
            pointer-events: none; z-index: 0;
            mask-image: radial-gradient(ellipse 70% 50% at 50% 30%, black 20%, transparent 100%);
        }
        .bg-glow-1 {
            position: fixed; top: -300px; left: 50%; transform: translateX(-50%);
            width: 900px; height: 600px;
            background: radial-gradient(ellipse, rgba(124,108,240,0.10), transparent 70%);
            pointer-events: none; z-index: 0;
        }
        .bg-glow-2 {
            position: fixed; top: 200px; right: -200px;
            width: 500px; height: 500px;
            background: radial-gradient(circle, rgba(0,223,168,0.06), transparent 70%);
            pointer-events: none; z-index: 0;
        }

        /* NAV */
        nav { position: fixed; top: 0; left: 0; right: 0; z-index: 1000; padding: 14px 32px; backdrop-filter: blur(24px) saturate(1.2); background: rgba(8,8,13,0.75); border-bottom: 1px solid rgba(30,30,53,0.6); }
        .nav-inner { max-width: 1100px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; }
        .logo { display: flex; align-items: center; gap: 10px; cursor: pointer; }
        .logo-icon { width: 36px; height: 36px; background: linear-gradient(135deg, var(--accent), var(--green)); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 16px; font-weight: 800; color: white; transform: rotate(-2deg); box-shadow: 0 2px 12px rgba(124,108,240,0.3); }
        .logo-text { font-size: 19px; font-weight: 700; letter-spacing: -0.5px; }
        .logo-text span { color: var(--accent-light); }
        .nav-right { display: flex; align-items: center; gap: 6px; }
        .nav-link { color: var(--text-secondary); font-size: 13.5px; font-weight: 500; padding: 7px 14px; border-radius: var(--radius-xs); transition: all 0.2s; cursor: pointer; text-decoration: none; }
        .nav-link:hover { color: var(--text-primary); background: rgba(255,255,255,0.04); }
        .nav-pill { padding: 7px 16px; background: rgba(0,223,168,0.1); border: 1px solid rgba(0,223,168,0.2); color: var(--green); font-size: 12px; font-weight: 600; border-radius: 100px; }

        /* FFmpeg status indicator */

        /* HERO */
        .hero { position: relative; z-index: 1; padding: 140px 24px 40px; text-align: center; max-width: 720px; margin: 0 auto; }
        .hero-eyebrow { display: inline-flex; align-items: center; gap: 8px; padding: 6px 16px; background: rgba(124,108,240,0.08); border: 1px solid rgba(124,108,240,0.15); border-radius: 100px; font-size: 12.5px; font-weight: 500; color: var(--accent-light); margin-bottom: 24px; animation: fadeIn 0.5s; }
        .hero-eyebrow .dot { width: 6px; height: 6px; background: var(--green); border-radius: 50%; animation: blink 2s infinite; }
        .hero h1 { font-size: clamp(36px, 5.5vw, 58px); font-weight: 900; line-height: 1.1; letter-spacing: -1.5px; margin-bottom: 16px; animation: fadeUp 0.6s; }
        .hero h1 .grad { background: linear-gradient(135deg, var(--accent-light), var(--green)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .hero-sub { font-size: 17px; color: var(--text-secondary); line-height: 1.65; max-width: 520px; margin: 0 auto 12px; animation: fadeUp 0.7s; }

        /* UPLOAD */
        .upload-section { position: relative; z-index: 1; max-width: 640px; margin: 0 auto; padding: 0 24px 32px; animation: fadeUp 0.8s; }
        .upload-zone { border: 2px dashed var(--border); border-radius: var(--radius); padding: 52px 32px; text-align: center; cursor: pointer; transition: all 0.35s cubic-bezier(0.4,0,0.2,1); background: rgba(19,19,32,0.5); backdrop-filter: blur(8px); }
        .upload-zone:hover { border-color: var(--accent); background: rgba(124,108,240,0.04); box-shadow: 0 0 0 6px var(--accent-glow), 0 20px 60px rgba(0,0,0,0.3); transform: translateY(-2px); }
        .upload-zone.dragover { border-color: var(--green); background: rgba(0,223,168,0.06); box-shadow: 0 0 0 6px var(--green-glow); transform: scale(1.01); }
        .upload-icon-wrap { width: 80px; height: 80px; margin: 0 auto 20px; background: linear-gradient(135deg, rgba(124,108,240,0.12), rgba(0,223,168,0.08)); border-radius: 50%; display: flex; align-items: center; justify-content: center; position: relative; }
        .upload-icon-wrap::after { content: ''; position: absolute; inset: -4px; border: 2px dashed rgba(124,108,240,0.2); border-radius: 50%; animation: spin 20s linear infinite; }
        .upload-icon { font-size: 36px; }
        .upload-title { font-size: 20px; font-weight: 700; margin-bottom: 8px; }
        .upload-title span { color: var(--accent-light); }
        .upload-hint { font-size: 14px; color: var(--text-muted); margin-bottom: 20px; line-height: 1.5; }
        .upload-btn { display: inline-flex; align-items: center; gap: 8px; padding: 13px 32px; background: linear-gradient(135deg, var(--accent), #9575ff); border: none; border-radius: var(--radius-sm); color: white; font-family: 'Outfit'; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.25s; box-shadow: 0 4px 20px rgba(124,108,240,0.25); }
        .upload-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 30px rgba(124,108,240,0.4); }
        .upload-formats { margin-top: 20px; display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; }
        .format-chip { padding: 3px 10px; background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.06); border-radius: 100px; font-family: 'JetBrains Mono'; font-size: 11px; color: var(--text-muted); font-weight: 500; }

        /* FILE INFO */
        .file-info-bar { display: flex; align-items: center; justify-content: space-between; background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius-md); padding: 16px 20px; margin-bottom: 20px; }
        .file-info-left { display: flex; align-items: center; gap: 14px; }
        .file-thumb { width: 56px; height: 40px; background: var(--bg-secondary); border-radius: var(--radius-xs); overflow: hidden; }
        .file-thumb video { width: 100%; height: 100%; object-fit: cover; }
        .file-name { font-size: 14px; font-weight: 600; max-width: 240px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .file-meta { font-size: 12px; color: var(--text-muted); font-family: 'JetBrains Mono'; margin-top: 2px; }
        .file-remove { background: rgba(255,95,150,0.1); border: 1px solid rgba(255,95,150,0.15); color: var(--pink); font-size: 12px; font-weight: 600; padding: 6px 14px; border-radius: var(--radius-xs); cursor: pointer; font-family: 'Outfit'; transition: all 0.2s; }
        .file-remove:hover { background: rgba(255,95,150,0.2); }

        /* ACTION GRID */
        .action-label { font-size: 13px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 14px; text-align: center; }
        .action-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .action-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius-md); padding: 20px 16px; text-align: center; cursor: pointer; transition: all 0.25s cubic-bezier(0.4,0,0.2,1); display: flex; flex-direction: column; align-items: center; gap: 8px; position: relative; overflow: hidden; }
        .action-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: var(--action-color, var(--accent)); opacity: 0; transition: opacity 0.3s; }
        .action-card:hover { border-color: var(--border-hover); background: var(--bg-card-hover); transform: translateY(-3px); box-shadow: 0 8px 32px rgba(0,0,0,0.3); }
        .action-card:hover::before { opacity: 1; }
        .action-emoji { font-size: 28px; }
        .action-name { font-size: 13.5px; font-weight: 600; }
        .action-desc { font-size: 11.5px; color: var(--text-muted); }

        /* USP */
        .usp-strip { position: relative; z-index: 1; max-width: 640px; margin: 0 auto; padding: 0 24px 60px; display: flex; justify-content: center; gap: 28px; flex-wrap: wrap; }
        .usp-item { display: flex; align-items: center; gap: 7px; font-size: 13px; color: var(--text-secondary); font-weight: 500; }
        .usp-check { color: var(--green); }

        /* TOOLS SECTION */
        .tools-section { position: relative; z-index: 1; max-width: 1100px; margin: 0 auto; padding: 40px 24px 80px; }
        .tools-header { display: flex; align-items: center; gap: 20px; margin-bottom: 36px; }
        .tools-title { font-size: 13px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 2px; white-space: nowrap; }
        .tools-line { flex: 1; height: 1px; background: var(--border); }
        .tools-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 12px; }
        .tool-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius-md); padding: 22px 20px; display: flex; align-items: flex-start; gap: 14px; transition: all 0.25s cubic-bezier(0.4,0,0.2,1); cursor: pointer; }
        .tool-card:hover { border-color: var(--border-hover); background: var(--bg-card-hover); transform: translateY(-2px); box-shadow: 0 8px 28px rgba(0,0,0,0.25); }
        .tool-emoji { font-size: 24px; flex-shrink: 0; margin-top: 2px; }
        .tool-info { flex: 1; }
        .tool-name { font-size: 14px; font-weight: 600; margin-bottom: 3px; }
        .tool-desc { font-size: 12px; color: var(--text-muted); line-height: 1.45; }
        .tool-badge { display: inline-block; margin-top: 6px; padding: 2px 8px; font-size: 10px; font-weight: 700; border-radius: 100px; text-transform: uppercase; letter-spacing: 0.5px; }
        .badge-hot { background: rgba(0,223,168,0.1); color: var(--green); }
        .badge-new { background: rgba(255,138,80,0.1); color: var(--orange); }
        .badge-ai { background: rgba(124,108,240,0.1); color: var(--accent-light); }

        /* HOW IT WORKS */
        .how-section { position: relative; z-index: 1; max-width: 800px; margin: 0 auto; padding: 40px 24px 80px; }
        .how-steps { display: flex; gap: 16px; margin-top: 36px; }
        .how-step { flex: 1; background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius-md); padding: 32px 22px; text-align: center; }
        .step-num { font-family: 'JetBrains Mono'; font-size: 11px; font-weight: 600; color: var(--accent-light); background: rgba(124,108,240,0.1); padding: 3px 10px; border-radius: 100px; display: inline-block; margin-bottom: 16px; }
        .step-icon { font-size: 32px; margin-bottom: 14px; }
        .how-step h3 { font-size: 16px; font-weight: 700; margin-bottom: 8px; }
        .how-step p { font-size: 13px; color: var(--text-muted); line-height: 1.55; }

        /* PRIVACY */
        .privacy-banner { position: relative; z-index: 1; max-width: 800px; margin: 0 auto; padding: 0 24px 80px; }
        .privacy-inner { background: linear-gradient(135deg, rgba(0,223,168,0.04), rgba(124,108,240,0.04)); border: 1px solid rgba(0,223,168,0.12); border-radius: var(--radius); padding: 44px 36px; text-align: center; }
        .privacy-inner h2 { font-size: 24px; font-weight: 800; margin-bottom: 12px; }
        .privacy-inner p { font-size: 15px; color: var(--text-secondary); line-height: 1.65; max-width: 500px; margin: 0 auto 24px; }
        .privacy-chips { display: flex; justify-content: center; gap: 12px; flex-wrap: wrap; }
        .p-chip { display: flex; align-items: center; gap: 6px; padding: 8px 16px; background: rgba(0,223,168,0.06); border: 1px solid rgba(0,223,168,0.1); border-radius: 100px; font-size: 13px; font-weight: 500; color: var(--green-dim); }

        /* FOOTER */
        footer { position: relative; z-index: 1; border-top: 1px solid var(--border); padding: 36px 24px; }
        .footer-inner { max-width: 1100px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; }
        .footer-copy { font-size: 12.5px; color: var(--text-muted); }
        .footer-links { display: flex; gap: 20px; }
        .footer-links a { font-size: 12.5px; color: var(--text-muted); text-decoration: none; transition: color 0.2s; }
        .footer-links a:hover { color: var(--text-secondary); }

        /* TOOL PAGE */
        .tool-page { position: fixed; inset: 0; z-index: 2000; background: var(--bg-primary); overflow-y: auto; animation: fadeIn 0.2s; }
        .tool-page-header { position: sticky; top: 0; z-index: 10; background: rgba(8,8,13,0.85); backdrop-filter: blur(24px); border-bottom: 1px solid var(--border); padding: 16px 32px; display: flex; align-items: center; justify-content: space-between; }
        .tool-page-back { display: flex; align-items: center; gap: 8px; background: none; border: 1px solid var(--border); color: var(--text-secondary); font-family: 'Outfit'; font-size: 13px; font-weight: 500; padding: 8px 16px; border-radius: var(--radius-xs); cursor: pointer; transition: all 0.2s; }
        .tool-page-back:hover { border-color: var(--border-hover); color: var(--text-primary); background: rgba(255,255,255,0.04); }
        .tool-page-title { font-size: 16px; font-weight: 700; }
        .tool-page-content { max-width: 800px; margin: 0 auto; padding: 48px 24px 80px; }

        /* SETTINGS */
        .settings-panel { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius-md); padding: 28px 24px; margin-bottom: 20px; }
        .settings-panel h3 { font-size: 15px; font-weight: 700; margin-bottom: 20px; }
        .setting-row { display: flex; align-items: center; justify-content: space-between; padding: 14px 0; border-bottom: 1px solid rgba(30,30,53,0.5); }
        .setting-row:last-child { border-bottom: none; }
        .setting-label { font-size: 13.5px; font-weight: 500; }
        .setting-hint { font-size: 11.5px; color: var(--text-muted); margin-top: 2px; }
        .setting-control { display: flex; align-items: center; gap: 10px; }
        .custom-select { background: var(--bg-secondary); border: 1px solid var(--border); color: var(--text-primary); font-family: 'Outfit'; font-size: 13px; padding: 8px 32px 8px 14px; border-radius: var(--radius-xs); cursor: pointer; outline: none; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%238585a5' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 10px center; }
        .custom-select:focus { border-color: var(--accent); }
        .custom-range { -webkit-appearance: none; appearance: none; width: 160px; height: 6px; background: var(--bg-secondary); border-radius: 3px; outline: none; }
        .custom-range::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; background: var(--accent); border-radius: 50%; cursor: pointer; border: 3px solid var(--bg-primary); }
        .range-value { font-family: 'JetBrains Mono'; font-size: 12px; font-weight: 600; color: var(--accent-light); min-width: 40px; text-align: right; }
        .custom-input { background: var(--bg-secondary); border: 1px solid var(--border); color: var(--text-primary); font-family: 'JetBrains Mono'; font-size: 13px; padding: 8px 12px; border-radius: var(--radius-xs); width: 80px; outline: none; }
        .custom-input:focus { border-color: var(--accent); }

        /* VIDEO PREVIEW */
        .video-preview { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius-md); overflow: hidden; margin-bottom: 20px; }
        .video-preview video { width: 100%; display: block; max-height: 400px; object-fit: contain; background: #000; }
        .video-info-strip { padding: 14px 20px; display: flex; align-items: center; justify-content: space-between; border-top: 1px solid var(--border); }
        .video-info-name { font-size: 13px; font-weight: 600; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 300px; }
        .video-info-details { font-size: 12px; color: var(--text-muted); font-family: 'JetBrains Mono'; }

        /* PROCESS BTN */
        .process-btn { display: flex; align-items: center; justify-content: center; gap: 10px; width: 100%; padding: 16px 32px; background: linear-gradient(135deg, var(--accent), #9575ff); border: none; border-radius: var(--radius-sm); color: white; font-family: 'Outfit'; font-size: 16px; font-weight: 700; cursor: pointer; transition: all 0.25s; box-shadow: 0 4px 24px rgba(124,108,240,0.3); }
        .process-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 36px rgba(124,108,240,0.45); }
        .process-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

        /* PROGRESS */
        .progress-outer { width: 100%; height: 8px; background: var(--bg-secondary); border-radius: 4px; overflow: hidden; margin: 20px 0 10px; }
        .progress-inner { height: 100%; background: linear-gradient(90deg, var(--accent), var(--green)); border-radius: 4px; transition: width 0.3s; }
        .progress-text { font-size: 12.5px; color: var(--text-secondary); text-align: center; font-weight: 500; }

        /* RESULT */
        .result-card { background: linear-gradient(135deg, rgba(0,223,168,0.06), rgba(124,108,240,0.04)); border: 1px solid rgba(0,223,168,0.15); border-radius: var(--radius-md); padding: 28px 24px; text-align: center; margin-top: 24px; }
        .result-icon { font-size: 48px; margin-bottom: 12px; }
        .result-title { font-size: 18px; font-weight: 700; margin-bottom: 6px; }
        .result-stats { font-size: 13px; color: var(--text-secondary); margin-bottom: 20px; line-height: 1.6; }
        .result-highlight { color: var(--green); font-weight: 700; }
        .result-preview { margin-bottom: 20px; }
        .result-preview video, .result-preview audio, .result-preview img { max-width: 100%; max-height: 300px; border-radius: var(--radius-sm); border: 1px solid var(--border); }
        .result-preview audio { width: 100%; }
        .download-btn { display: inline-flex; align-items: center; gap: 8px; padding: 14px 40px; background: linear-gradient(135deg, var(--green-dim), var(--green)); border: none; border-radius: var(--radius-sm); color: #08080d; font-family: 'Outfit'; font-size: 15px; font-weight: 700; cursor: pointer; transition: all 0.25s; box-shadow: 0 4px 20px rgba(0,223,168,0.25); text-decoration: none; }
        .download-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 32px rgba(0,223,168,0.4); }
        .another-btn { display: inline-flex; align-items: center; gap: 6px; margin-top: 14px; background: none; border: 1px solid var(--border); color: var(--text-secondary); font-family: 'Outfit'; font-size: 13px; font-weight: 500; padding: 10px 24px; border-radius: var(--radius-xs); cursor: pointer; transition: all 0.2s; }
        .another-btn:hover { border-color: var(--border-hover); color: var(--text-primary); }

        /* SPINNER */
        .spinner { width: 20px; height: 20px; border: 2.5px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 0.7s linear infinite; }

        @keyframes fadeIn { from { opacity: 0 } to { opacity: 1 } }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(20px) } to { opacity: 1; transform: translateY(0) } }
        @keyframes spin { to { transform: rotate(360deg) } }
        @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }

        @media (max-width: 768px) {
            .hero { padding: 120px 20px 30px; }
            .hero h1 { font-size: 32px; }
            .nav-right .nav-link { display: none; }
            .action-grid { grid-template-columns: repeat(2, 1fr); }
            .tools-grid { grid-template-columns: 1fr 1fr; }
            .how-steps { flex-direction: column; }
            .footer-inner { flex-direction: column; gap: 12px; text-align: center; }
            .setting-row { flex-direction: column; align-items: flex-start; gap: 10px; }
        }
        @media (max-width: 480px) {
            .action-grid { grid-template-columns: 1fr 1fr; }
            .tools-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="bg-grid"></div>
    <div class="bg-glow-1"></div>
    <div class="bg-glow-2"></div>
    <div id="root"></div>

    <script type="module">
import React, { useState, useRef, useEffect, useCallback } from 'react';
import { createRoot } from 'react-dom/client';
import { FFmpeg } from '@ffmpeg/ffmpeg';
import { fetchFile, toBlobURL } from '@ffmpeg/util';

// =============================================
// FFmpeg Singleton â€” Preloads on app startup
// =============================================
const ffmpegInstance = new FFmpeg();
let ffmpegReady = false;
let ffmpegLoadPromise = null;
let onProgressCallback = null;

ffmpegInstance.on('progress', ({ progress }) => {
    if (onProgressCallback) onProgressCallback(Math.min(Math.round(progress * 100), 100));
});

async function loadFFmpeg(onStatus) {
    if (ffmpegReady) return;
    if (ffmpegLoadPromise) return ffmpegLoadPromise;

    ffmpegLoadPromise = (async () => {
        if (onStatus) onStatus('Loading FFmpeg core...');
        const base = 'https://cdn.jsdelivr.net/npm/@ffmpeg/core@0.12.6/dist/esm';
        const workerURL = await toBlobURL(
            'https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.12.10/dist/esm/worker.js',
            'text/javascript'
        );
        if (onStatus) onStatus('Loading WebAssembly...');
        await ffmpegInstance.load({
            coreURL: await toBlobURL(`${base}/ffmpeg-core.js`, 'text/javascript'),
            wasmURL: await toBlobURL(`${base}/ffmpeg-core.wasm`, 'application/wasm'),
            classWorkerURL: workerURL,
        });
        ffmpegReady = true;
        if (onStatus) onStatus('Ready');
    })();

    return ffmpegLoadPromise;
}

function getExt(name) {
    const i = name.lastIndexOf('.');
    return i >= 0 ? name.substring(i) : '.mp4';
}
function fmtSize(b) {
    if (b < 1024) return b + ' B';
    if (b < 1048576) return (b/1024).toFixed(1) + ' KB';
    return (b/1048576).toFixed(1) + ' MB';
}
function fmtDur(s) {
    if (!s || isNaN(s)) return '0:00';
    return Math.floor(s/60) + ':' + String(Math.floor(s%60)).padStart(2,'0');
}

// =============================================
// TOOL DEFINITIONS
// =============================================
const ACTIONS = [
    { id: 'compress', emoji: 'ðŸ“¦', name: 'Compress', desc: 'Reduce file size', color: 'var(--green)' },
    { id: 'convert', emoji: 'ðŸ”„', name: 'Convert', desc: 'Change format', color: 'var(--blue)' },
    { id: 'trim', emoji: 'âœ‚ï¸', name: 'Trim / Cut', desc: 'Cut to length', color: 'var(--orange)' },
    { id: 'audio', emoji: 'ðŸŽµ', name: 'Extract Audio', desc: 'Save as MP3', color: 'var(--pink)' },
    { id: 'gif', emoji: 'ðŸŽžï¸', name: 'Make GIF', desc: 'Create animation', color: 'var(--yellow)' },
    { id: 'mute', emoji: 'ðŸ”‡', name: 'Remove Audio', desc: 'Mute the video', color: 'var(--accent)' },
];

const ALL_TOOLS = [
    { id: 'compress', emoji: 'ðŸ“¦', name: 'Video Compressor', desc: 'Reduce file size up to 90%', badge: 'hot' },
    { id: 'audio', emoji: 'ðŸŽµ', name: 'Video to MP3', desc: 'Extract audio from video', badge: 'hot' },
    { id: 'trim', emoji: 'âœ‚ï¸', name: 'Video Trimmer', desc: 'Cut video to exact length', badge: 'hot' },
    { id: 'convert', emoji: 'ðŸ”„', name: 'Video Converter', desc: 'MP4, AVI, MOV, WebM, MKV' },
    { id: 'gif', emoji: 'ðŸŽžï¸', name: 'Video to GIF', desc: 'Create animated GIFs' },
    { id: 'mute', emoji: 'ðŸ”‡', name: 'Remove Audio', desc: 'Mute video completely' },
    { id: 'resize', emoji: 'ðŸ“', name: 'Resize Video', desc: 'Change resolution & ratio' },
    { id: 'rotate', emoji: 'ðŸ”ƒ', name: 'Rotate Video', desc: 'Rotate 90Â°, 180Â° or flip' },
    { id: 'speed', emoji: 'â©', name: 'Change Speed', desc: 'Speed up or slow down' },
    { id: 'reverse', emoji: 'âª', name: 'Reverse Video', desc: 'Play video backwards' },
    { id: 'compress-wa', emoji: 'ðŸ’¬', name: 'Compress for WhatsApp', desc: 'Under 16MB for sharing', badge: 'new' },
    { id: 'compress-dc', emoji: 'ðŸŽ®', name: 'Compress for Discord', desc: 'Under 8MB / 25MB limit', badge: 'new' },
    { id: 'compress-email', emoji: 'ðŸ“§', name: 'Compress for Email', desc: 'Small enough for attachments' },
    { id: 'mp4-webm', emoji: 'ðŸŒ', name: 'MP4 to WebM', desc: 'Web-optimized format' },
];

// =============================================
// FFmpeg PROCESS FUNCTIONS
// =============================================
async function processWithFFmpeg(file, toolId, settings) {
    const ext = getExt(file.name);
    const inputName = 'input' + ext;
    await ffmpegInstance.writeFile(inputName, await fetchFile(file));

    let args, outputName;

    switch (toolId) {
        case 'compress': {
            const crf = settings.quality || 28;
            const res = settings.resolution || 'original';
            outputName = 'output.mp4';
            args = ['-i', inputName];
            if (res !== 'original') args.push('-vf', `scale=-2:${res}`);
            args.push('-c:v', 'libx264', '-crf', String(crf), '-preset', 'fast', '-c:a', 'aac', '-b:a', '128k', '-movflags', '+faststart', outputName);
            break;
        }
        case 'compress-wa': {
            outputName = 'output.mp4';
            args = ['-i', inputName, '-vf', 'scale=-2:480', '-c:v', 'libx264', '-crf', '32', '-preset', 'fast', '-c:a', 'aac', '-b:a', '96k', '-movflags', '+faststart', outputName];
            break;
        }
        case 'compress-dc': {
            outputName = 'output.mp4';
            args = ['-i', inputName, '-vf', 'scale=-2:480', '-c:v', 'libx264', '-crf', '35', '-preset', 'fast', '-c:a', 'aac', '-b:a', '64k', '-movflags', '+faststart', outputName];
            break;
        }
        case 'compress-email': {
            outputName = 'output.mp4';
            args = ['-i', inputName, '-vf', 'scale=-2:480', '-c:v', 'libx264', '-crf', '33', '-preset', 'fast', '-c:a', 'aac', '-b:a', '96k', '-movflags', '+faststart', outputName];
            break;
        }
        case 'convert':
        case 'mp4-webm': {
            const fmt = toolId === 'mp4-webm' ? 'webm' : (settings.format || 'mp4');
            const qMap = { high: '23', medium: '28', low: '35' };
            const q = qMap[settings.convertQuality || 'medium'];
            outputName = 'output.' + fmt;
            if (fmt === 'webm') {
                args = ['-i', inputName, '-c:v', 'libvpx', '-crf', q, '-b:v', '1M', '-c:a', 'libvorbis', outputName];
            } else {
                args = ['-i', inputName, '-c:v', 'libx264', '-crf', q, '-c:a', 'aac', '-movflags', '+faststart', outputName];
            }
            break;
        }
        case 'trim': {
            outputName = 'output' + ext;
            const ss = settings.trimStart || '0';
            const dur = (parseFloat(settings.trimEnd || 10) - parseFloat(ss));
            // -c copy = instant trim, no re-encode, keeps original format!
            args = ['-i', inputName, '-ss', String(ss), '-t', String(dur), '-c', 'copy', '-movflags', '+faststart', outputName];
            break;
        }
        case 'audio': {
            outputName = 'output.mp3';
            const br = settings.audioBitrate || '192';
            args = ['-i', inputName, '-vn', '-acodec', 'libmp3lame', '-b:a', br + 'k', outputName];
            break;
        }
        case 'gif': {
            outputName = 'output.gif';
            const dur = settings.gifDuration || '5';
            const w = settings.gifWidth || '320';
            const fps = settings.gifFps || '10';
            args = ['-i', inputName, '-t', dur, '-vf', `fps=${fps},scale=${w}:-1:flags=lanczos`, '-loop', '0', outputName];
            break;
        }
        case 'mute': {
            outputName = 'output' + ext;
            args = ['-i', inputName, '-an', '-c:v', 'copy', outputName];
            break;
        }
        case 'speed': {
            outputName = 'output.mp4';
            const spd = parseFloat(settings.speed || 2);
            const pts = (1 / spd).toFixed(4);
            let atempo = [];
            let s = spd;
            // atempo only supports 0.5-2.0, chain if needed
            while (s > 2.0) { atempo.push('atempo=2.0'); s /= 2.0; }
            while (s < 0.5) { atempo.push('atempo=0.5'); s /= 0.5; }
            atempo.push(`atempo=${s.toFixed(4)}`);
            args = ['-i', inputName, '-filter:v', `setpts=${pts}*PTS`, '-filter:a', atempo.join(','), '-movflags', '+faststart', outputName];
            break;
        }
        case 'resize': {
            outputName = 'output.mp4';
            const res = settings.resizeValue || '1280:720';
            args = ['-i', inputName, '-vf', `scale=${res}`, '-c:a', 'copy', '-movflags', '+faststart', outputName];
            break;
        }
        case 'rotate': {
            outputName = 'output.mp4';
            const rot = settings.rotateValue || '90';
            let vf = 'transpose=1';
            if (rot === '180') vf = 'transpose=1,transpose=1';
            else if (rot === '270') vf = 'transpose=2';
            else if (rot === 'hflip') vf = 'hflip';
            else if (rot === 'vflip') vf = 'vflip';
            args = ['-i', inputName, '-vf', vf, '-c:a', 'copy', '-movflags', '+faststart', outputName];
            break;
        }
        case 'reverse': {
            outputName = 'output.mp4';
            args = ['-i', inputName, '-vf', 'reverse', '-af', 'areverse', '-movflags', '+faststart', outputName];
            break;
        }
        default:
            throw new Error('Tool not supported yet');
    }

    await ffmpegInstance.exec(args);
    const data = await ffmpegInstance.readFile(outputName);

    let mime = 'video/mp4';
    if (outputName.endsWith('.mp3')) mime = 'audio/mpeg';
    else if (outputName.endsWith('.gif')) mime = 'image/gif';
    else if (outputName.endsWith('.webm')) mime = 'video/webm';
    else if (outputName.endsWith('.avi')) mime = 'video/avi';

    // Clean up
    try { await ffmpegInstance.deleteFile(inputName); } catch(e) {}
    try { await ffmpegInstance.deleteFile(outputName); } catch(e) {}

    return { blob: new Blob([data.buffer], { type: mime }), filename: outputName, mime };
}

// =============================================
// REACT COMPONENTS
// =============================================
const e = React.createElement;

function CheckIcon() {
    return e('svg', { viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2.5, width: 16, height: 16 },
        e('polyline', { points: '20 6 9 17 4 12' }));
}

function ToolSettings({ toolId, settings, setSettings, videoDuration }) {
    const s = (key, val) => setSettings(prev => ({ ...prev, [key]: val }));

    if (toolId === 'compress' || toolId === 'compress-wa' || toolId === 'compress-dc' || toolId === 'compress-email') {
        const isCustom = toolId === 'compress';
        return e('div', { className: 'settings-panel' },
            e('h3', null, 'âš™ï¸ Compression Settings'),
            isCustom && e('div', { className: 'setting-row' },
                e('div', null,
                    e('div', { className: 'setting-label' }, 'Quality (CRF)'),
                    e('div', { className: 'setting-hint' }, 'Lower = better quality, larger file')),
                e('div', { className: 'setting-control' },
                    e('input', { type: 'range', className: 'custom-range', min: 18, max: 45, value: settings.quality || 28, onChange: ev => s('quality', ev.target.value) }),
                    e('span', { className: 'range-value' }, settings.quality || 28))),
            isCustom && e('div', { className: 'setting-row' },
                e('div', null,
                    e('div', { className: 'setting-label' }, 'Resolution'),
                    e('div', { className: 'setting-hint' }, 'Downscale to reduce size further')),
                e('div', { className: 'setting-control' },
                    e('select', { className: 'custom-select', value: settings.resolution || '720', onChange: ev => s('resolution', ev.target.value) },
                        e('option', { value: 'original' }, 'Original'),
                        e('option', { value: '1080' }, '1080p'),
                        e('option', { value: '720' }, '720p'),
                        e('option', { value: '480' }, '480p'),
                        e('option', { value: '360' }, '360p')))),
            !isCustom && e('div', { className: 'setting-row' },
                e('div', null,
                    e('div', { className: 'setting-label' }, toolId === 'compress-wa' ? 'Target: Under 16 MB' : toolId === 'compress-dc' ? 'Target: Under 8/25 MB' : 'Target: Under 25 MB'),
                    e('div', { className: 'setting-hint' }, 'Optimized automatically')))
        );
    }

    if (toolId === 'convert' || toolId === 'mp4-webm') {
        return e('div', { className: 'settings-panel' },
            e('h3', null, 'âš™ï¸ Conversion Settings'),
            e('div', { className: 'setting-row' },
                e('div', null, e('div', { className: 'setting-label' }, 'Output Format')),
                e('div', { className: 'setting-control' },
                    e('select', { className: 'custom-select', value: toolId === 'mp4-webm' ? 'webm' : (settings.format || 'mp4'), onChange: ev => s('format', ev.target.value) },
                        e('option', { value: 'mp4' }, 'MP4'), e('option', { value: 'webm' }, 'WebM'), e('option', { value: 'avi' }, 'AVI')))),
            e('div', { className: 'setting-row' },
                e('div', null, e('div', { className: 'setting-label' }, 'Quality')),
                e('div', { className: 'setting-control' },
                    e('select', { className: 'custom-select', value: settings.convertQuality || 'medium', onChange: ev => s('convertQuality', ev.target.value) },
                        e('option', { value: 'high' }, 'High'), e('option', { value: 'medium' }, 'Medium'), e('option', { value: 'low' }, 'Low'))))
        );
    }

    if (toolId === 'trim') {
        return e('div', { className: 'settings-panel' },
            e('h3', null, 'âœ‚ï¸ Trim Settings'),
            e('div', { className: 'setting-row' },
                e('div', null,
                    e('div', { className: 'setting-label' }, 'Start Time (seconds)'),
                    e('div', { className: 'setting-hint' }, 'Uses stream copy â€” instant, no re-encode!')),
                e('div', { className: 'setting-control' },
                    e('input', { type: 'number', className: 'custom-input', value: settings.trimStart || 0, min: 0, step: 0.1, onChange: ev => s('trimStart', ev.target.value) }))),
            e('div', { className: 'setting-row' },
                e('div', null, e('div', { className: 'setting-label' }, 'End Time (seconds)')),
                e('div', { className: 'setting-control' },
                    e('input', { type: 'number', className: 'custom-input', value: settings.trimEnd ?? Math.floor(videoDuration || 10), min: 0, step: 0.1, onChange: ev => s('trimEnd', ev.target.value) })))
        );
    }

    if (toolId === 'audio') {
        return e('div', { className: 'settings-panel' },
            e('h3', null, 'ðŸŽµ Audio Settings'),
            e('div', { className: 'setting-row' },
                e('div', null, e('div', { className: 'setting-label' }, 'Bitrate')),
                e('div', { className: 'setting-control' },
                    e('select', { className: 'custom-select', value: settings.audioBitrate || '192', onChange: ev => s('audioBitrate', ev.target.value) },
                        e('option', { value: '320' }, '320 kbps (Best)'), e('option', { value: '256' }, '256 kbps'),
                        e('option', { value: '192' }, '192 kbps'), e('option', { value: '128' }, '128 kbps'))))
        );
    }

    if (toolId === 'gif') {
        return e('div', { className: 'settings-panel' },
            e('h3', null, 'ðŸŽžï¸ GIF Settings'),
            e('div', { className: 'setting-row' },
                e('div', null, e('div', { className: 'setting-label' }, 'Duration (seconds)')),
                e('div', { className: 'setting-control' },
                    e('input', { type: 'number', className: 'custom-input', value: settings.gifDuration || 5, min: 1, max: 30, onChange: ev => s('gifDuration', ev.target.value) }))),
            e('div', { className: 'setting-row' },
                e('div', null, e('div', { className: 'setting-label' }, 'Width')),
                e('div', { className: 'setting-control' },
                    e('select', { className: 'custom-select', value: settings.gifWidth || '320', onChange: ev => s('gifWidth', ev.target.value) },
                        e('option', { value: '480' }, '480px'), e('option', { value: '320' }, '320px'), e('option', { value: '240' }, '240px')))),
            e('div', { className: 'setting-row' },
                e('div', null, e('div', { className: 'setting-label' }, 'FPS')),
                e('div', { className: 'setting-control' },
                    e('select', { className: 'custom-select', value: settings.gifFps || '10', onChange: ev => s('gifFps', ev.target.value) },
                        e('option', { value: '15' }, '15 fps'), e('option', { value: '10' }, '10 fps'), e('option', { value: '5' }, '5 fps'))))
        );
    }

    if (toolId === 'speed') {
        return e('div', { className: 'settings-panel' },
            e('h3', null, 'â© Speed Settings'),
            e('div', { className: 'setting-row' },
                e('div', null, e('div', { className: 'setting-label' }, 'Playback Speed')),
                e('div', { className: 'setting-control' },
                    e('input', { type: 'range', className: 'custom-range', min: 0.25, max: 4, step: 0.25, value: settings.speed || 2, onChange: ev => s('speed', ev.target.value) }),
                    e('span', { className: 'range-value' }, (settings.speed || 2) + 'x')))
        );
    }

    if (toolId === 'resize') {
        return e('div', { className: 'settings-panel' },
            e('h3', null, 'ðŸ“ Resize Settings'),
            e('div', { className: 'setting-row' },
                e('div', null, e('div', { className: 'setting-label' }, 'Resolution')),
                e('div', { className: 'setting-control' },
                    e('select', { className: 'custom-select', value: settings.resizeValue || '1280:720', onChange: ev => s('resizeValue', ev.target.value) },
                        e('option', { value: '1920:1080' }, '1920Ã—1080'), e('option', { value: '1280:720' }, '1280Ã—720'),
                        e('option', { value: '854:480' }, '854Ã—480'), e('option', { value: '640:360' }, '640Ã—360'),
                        e('option', { value: '1080:1920' }, '1080Ã—1920 (Vertical)'), e('option', { value: '1080:1080' }, '1080Ã—1080 (Square)'))))
        );
    }

    if (toolId === 'rotate') {
        return e('div', { className: 'settings-panel' },
            e('h3', null, 'ðŸ”ƒ Rotate Settings'),
            e('div', { className: 'setting-row' },
                e('div', null, e('div', { className: 'setting-label' }, 'Rotation')),
                e('div', { className: 'setting-control' },
                    e('select', { className: 'custom-select', value: settings.rotateValue || '90', onChange: ev => s('rotateValue', ev.target.value) },
                        e('option', { value: '90' }, '90Â° Clockwise'), e('option', { value: '180' }, '180Â°'),
                        e('option', { value: '270' }, '90Â° Counter-clockwise'),
                        e('option', { value: 'hflip' }, 'Flip Horizontal'), e('option', { value: 'vflip' }, 'Flip Vertical'))))
        );
    }

    if (toolId === 'mute') {
        return e('div', { className: 'settings-panel' },
            e('h3', null, 'ðŸ”‡ Remove Audio'),
            e('div', { className: 'setting-row' },
                e('div', null,
                    e('div', { className: 'setting-label' }, 'Stream copy â€” instant, keeps original quality'),
                    e('div', { className: 'setting-hint' }, 'Only removes audio tracks, video is untouched')))
        );
    }

    if (toolId === 'reverse') {
        return e('div', { className: 'settings-panel' },
            e('h3', null, 'âª Reverse Video'),
            e('div', { className: 'setting-row' },
                e('div', null,
                    e('div', { className: 'setting-label' }, 'Reverses both video and audio'),
                    e('div', { className: 'setting-hint' }, 'Note: requires full re-encode, may take time for long videos')))
        );
    }

    return null;
}

// =============================================
// TOOL PAGE COMPONENT
// =============================================
function ToolPage({ toolId, file, onClose }) {
    const [settings, setSettings] = useState({});
    const [processing, setProcessing] = useState(false);
    const [progress, setProgress] = useState(0);
    const [progressText, setProgressText] = useState('');
    const [result, setResult] = useState(null);
    const [videoDuration, setVideoDuration] = useState(0);
    const videoRef = useRef(null);
    const fileInputRef = useRef(null);
    const [localFile, setLocalFile] = useState(file);

    const tool = [...ACTIONS, ...ALL_TOOLS].find(t => t.id === toolId) || { emoji: 'ðŸ”§', name: toolId };

    useEffect(() => {
        setResult(null);
        setProgress(0);
        setSettings({});
    }, [toolId]);

    const handleProcess = useCallback(async () => {
        if (!localFile || processing) return;
        setProcessing(true);
        setProgress(0);
        setProgressText('Preparing...');

        try {
            await loadFFmpeg(msg => setProgressText(msg));
            onProgressCallback = pct => {
                setProgress(pct);
                setProgressText(`Processing... ${pct}%`);
            };
            setProgressText('Processing with FFmpeg...');
            const res = await processWithFFmpeg(localFile, toolId, settings);
            onProgressCallback = null;
            setResult(res);
        } catch (err) {
            console.error(err);
            setProgressText('Error: ' + err.message);
            onProgressCallback = null;
        }
        setProcessing(false);
    }, [localFile, toolId, settings, processing]);

    const handleNewFile = (f) => {
        setLocalFile(f);
        setResult(null);
        setProgress(0);
    };

    const previewUrl = localFile ? URL.createObjectURL(localFile) : null;
    const resultUrl = result ? URL.createObjectURL(result.blob) : null;

    return e('div', { className: 'tool-page' },
        e('div', { className: 'tool-page-header' },
            e('button', { className: 'tool-page-back', onClick: onClose }, 'â† Back'),
            e('div', { className: 'tool-page-title' }, `${tool.emoji} ${tool.name}`),
            e('div', { style: { width: 80 } })),

        e('div', { className: 'tool-page-content' },
            // Upload zone if no file
            !localFile && e('div', { className: 'upload-zone', onClick: () => fileInputRef.current?.click(),
                onDragOver: ev => { ev.preventDefault(); ev.currentTarget.classList.add('dragover'); },
                onDragLeave: ev => ev.currentTarget.classList.remove('dragover'),
                onDrop: ev => { ev.preventDefault(); ev.currentTarget.classList.remove('dragover'); const f = ev.dataTransfer.files[0]; if (f?.type.startsWith('video/')) handleNewFile(f); }
            },
                e('div', { className: 'upload-icon-wrap' }, e('div', { className: 'upload-icon' }, 'ðŸŽ¬')),
                e('div', { className: 'upload-title' }, 'Drop your video here, or ', e('span', null, 'browse')),
                e('div', { className: 'upload-hint' }, 'Supports MP4, WebM, MOV, AVI, MKV'),
                e('button', { className: 'upload-btn', onClick: ev => { ev.stopPropagation(); fileInputRef.current?.click(); } }, 'Choose Video File'),
                e('input', { ref: fileInputRef, type: 'file', accept: 'video/*', hidden: true, onChange: ev => { if (ev.target.files[0]) handleNewFile(ev.target.files[0]); } })),

            // Video preview
            localFile && !result && e('div', { className: 'video-preview' },
                e('video', { ref: videoRef, src: previewUrl, controls: true,
                    onLoadedMetadata: () => { if (videoRef.current) setVideoDuration(videoRef.current.duration); }
                }),
                e('div', { className: 'video-info-strip' },
                    e('div', { className: 'video-info-name' }, localFile.name),
                    e('div', { className: 'video-info-details' }, `${fmtSize(localFile.size)} Â· ${fmtDur(videoDuration)}`))),

            // Settings
            localFile && !result && e(ToolSettings, { toolId, settings, setSettings, videoDuration }),

            // Process button
            localFile && !result && e('button', {
                className: 'process-btn',
                disabled: processing,
                onClick: handleProcess
            }, processing ? e('div', { className: 'spinner' }) : null, processing ? 'Processing...' : 'âš¡ Start Processing'),

            // Progress
            processing && e('div', null,
                e('div', { className: 'progress-outer' }, e('div', { className: 'progress-inner', style: { width: progress + '%' } })),
                e('div', { className: 'progress-text' }, progressText)),

            // Result
            result && e('div', { className: 'result-card' },
                e('div', { className: 'result-icon' }, 'âœ…'),
                e('div', { className: 'result-title' }, 'Processing Complete!'),
                e('div', { className: 'result-stats', dangerouslySetInnerHTML: { __html:
                    `Original: <strong>${fmtSize(localFile.size)}</strong> â†’ Output: <strong class="result-highlight">${fmtSize(result.blob.size)}</strong>` +
                    (localFile.size > result.blob.size ? `<br>Reduced by <span class="result-highlight">${((1 - result.blob.size/localFile.size)*100).toFixed(1)}%</span>` : '')
                }}),
                e('div', { className: 'result-preview' },
                    result.mime.startsWith('audio/') ? e('audio', { controls: true, src: resultUrl }) :
                    result.mime === 'image/gif' ? e('img', { src: resultUrl }) :
                    e('video', { controls: true, src: resultUrl })),
                e('a', { className: 'download-btn', href: resultUrl, download: result.filename }, `â¬‡ Download ${result.filename}`),
                e('br'),
                e('button', { className: 'another-btn', onClick: () => { setResult(null); setLocalFile(null); setProgress(0); } }, 'â†» Process Another Video'))
        )
    );
}

// =============================================
// MAIN APP
// =============================================
function App() {
    const [file, setFile] = useState(null);
    const [activeTool, setActiveTool] = useState(null);
    const [dragOver, setDragOver] = useState(false);
    const fileInputRef = useRef(null);

    const handleFile = (f) => {
        if (f?.type.startsWith('video/')) setFile(f);
    };

    const openTool = (id) => setActiveTool(id);
    const closeTool = () => setActiveTool(null);

    if (activeTool) {
        return e(ToolPage, { toolId: activeTool, file, onClose: closeTool });
    }

    const thumbUrl = file ? URL.createObjectURL(file) : null;

    return e('div', null,
        // NAV
        e('nav', null,
            e('div', { className: 'nav-inner' },
                e('div', { className: 'logo', onClick: () => { setFile(null); setActiveTool(null); } },
                    e('div', { className: 'logo-icon' }, 'â–¶'),
                    e('div', { className: 'logo-text' }, 'FreeVid', e('span', null, 'Tools'))),
                e('div', { className: 'nav-right' },
                    e('a', { href: '#tools', className: 'nav-link' }, 'All Tools'),
                    e('a', { href: '#how', className: 'nav-link' }, 'How It Works'),
                    e('div', { className: 'nav-pill' }, 'âœ¦ 100% Free')))),

        // HERO
        e('section', { className: 'hero' },
            e('div', { className: 'hero-eyebrow' },
                e('span', { className: 'dot' }),
                'Everything runs in your browser â€” your files stay private'),
            e('h1', null, 'Drop a Video,', e('br'), e('span', { className: 'grad' }, "We'll Handle the Rest")),
            e('p', { className: 'hero-sub' }, 'Compress, convert, trim, extract audio and more â€” instantly in your browser. No upload to servers. No signup. No watermark.')),

        // UPLOAD
        e('div', { className: 'upload-section' },
            !file && e('div', {
                className: `upload-zone ${dragOver ? 'dragover' : ''}`,
                onClick: () => fileInputRef.current?.click(),
                onDragOver: ev => { ev.preventDefault(); setDragOver(true); },
                onDragLeave: () => setDragOver(false),
                onDrop: ev => { ev.preventDefault(); setDragOver(false); handleFile(ev.dataTransfer.files[0]); }
            },
                e('div', { className: 'upload-icon-wrap' }, e('div', { className: 'upload-icon' }, 'ðŸŽ¬')),
                e('div', { className: 'upload-title' }, 'Drop your video here, or ', e('span', null, 'browse')),
                e('div', { className: 'upload-hint' }, 'Your video never leaves your device â€” processed 100% locally'),
                e('button', { className: 'upload-btn', onClick: ev => { ev.stopPropagation(); fileInputRef.current?.click(); } }, 'Choose Video File'),
                e('div', { className: 'upload-formats' },
                    ['MP4','AVI','MOV','WebM','MKV','FLV','WMV'].map(f => e('span', { key: f, className: 'format-chip' }, f))),
                e('input', { ref: fileInputRef, type: 'file', accept: 'video/*', hidden: true, onChange: ev => handleFile(ev.target.files[0]) })),

            file && e('div', null,
                e('div', { className: 'file-info-bar' },
                    e('div', { className: 'file-info-left' },
                        e('div', { className: 'file-thumb' }, e('video', { src: thumbUrl, muted: true })),
                        e('div', null,
                            e('div', { className: 'file-name' }, file.name),
                            e('div', { className: 'file-meta' }, `${fmtSize(file.size)} Â· ${file.type.split('/')[1]?.toUpperCase()}`))),
                    e('button', { className: 'file-remove', onClick: () => setFile(null) }, 'âœ• Remove')),

                e('div', { className: 'action-label' }, 'What do you want to do?'),
                e('div', { className: 'action-grid' },
                    ACTIONS.map(a => e('div', {
                        key: a.id, className: 'action-card', style: { '--action-color': a.color },
                        onClick: () => openTool(a.id)
                    },
                        e('div', { className: 'action-emoji' }, a.emoji),
                        e('div', { className: 'action-name' }, a.name),
                        e('div', { className: 'action-desc' }, a.desc)))))),

        // USP
        e('div', { className: 'usp-strip' },
            ['No file upload', 'No signup', 'No watermark', 'Works on mobile'].map(txt =>
                e('div', { key: txt, className: 'usp-item' },
                    e('span', { className: 'usp-check' }, e(CheckIcon)), txt))),

        // ALL TOOLS
        e('section', { className: 'tools-section', id: 'tools' },
            e('div', { className: 'tools-header' },
                e('div', { className: 'tools-title' }, 'All Tools'),
                e('div', { className: 'tools-line' })),
            e('div', { className: 'tools-grid' },
                ALL_TOOLS.map(t => e('div', { key: t.id, className: 'tool-card', onClick: () => openTool(t.id) },
                    e('div', { className: 'tool-emoji' }, t.emoji),
                    e('div', { className: 'tool-info' },
                        e('div', { className: 'tool-name' }, t.name),
                        e('div', { className: 'tool-desc' }, t.desc),
                        t.badge && e('span', { className: `tool-badge badge-${t.badge}` },
                            t.badge === 'hot' ? 'âš¡ Popular' : t.badge === 'new' ? 'ðŸ†• New' : 'âœ¨ AI')))))),

        // HOW IT WORKS
        e('section', { className: 'how-section', id: 'how' },
            e('div', { className: 'tools-header' },
                e('div', { className: 'tools-title' }, 'How It Works'),
                e('div', { className: 'tools-line' })),
            e('div', { className: 'how-steps' },
                [{ n: '01', icon: 'ðŸ“‚', title: 'Drop Your Video', desc: 'Select or drag & drop any video file. Supports all major formats.' },
                 { n: '02', icon: 'âš¡', title: 'Pick an Action', desc: 'Compress, convert, trim, extract audio â€” choose what you need.' },
                 { n: '03', icon: 'â¬‡ï¸', title: 'Download Result', desc: 'Get your processed video instantly. No watermark, no limits.' }]
                .map(s => e('div', { key: s.n, className: 'how-step' },
                    e('span', { className: 'step-num' }, `Step ${s.n}`),
                    e('div', { className: 'step-icon' }, s.icon),
                    e('h3', null, s.title),
                    e('p', null, s.desc))))),

        // PRIVACY
        e('section', { className: 'privacy-banner' },
            e('div', { className: 'privacy-inner' },
                e('h2', null, 'ðŸ›¡ï¸ Your Privacy, Protected'),
                e('p', null, 'Unlike others, we process everything in your browser. Your videos never touch our servers â€” ever.'),
                e('div', { className: 'privacy-chips' },
                    ['Client-side only', 'Zero server uploads', 'Works offline'].map(t =>
                        e('div', { key: t, className: 'p-chip' }, e(CheckIcon), t))))),

        // FOOTER
        e('footer', null,
            e('div', { className: 'footer-inner' },
                e('div', { className: 'footer-copy' }, 'Â© 2026 FreeVidTools.com â€” Free Online Video Processing Tools'),
                e('div', { className: 'footer-links' },
                    ['About', 'Privacy', 'Contact', 'Blog'].map(l =>
                        e('a', { key: l, href: '#' }, l)))))
    );
}

// Mount React app
createRoot(document.getElementById('root')).render(e(App));
    </script>
</body>
</html>
